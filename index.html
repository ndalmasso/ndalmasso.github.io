<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nicolò Dalmasso</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Inconsolata:wght@300;400&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:          #16120e;
      --bg2:         #1c1710;
      --sand:        #e8dcc8;
      --sand-dim:    rgba(232,220,200,0.42);
      --sand-faint:  rgba(232,220,200,0.12);
      --rust:        #d67134;
      --rust-dim:    rgba(214, 113, 52, 0.5);
      --charcoal:    #2e2920;
      --border:      #282420;
      --font-s:      'Playfair Display', serif;
      --font-m:      'Inconsolata', monospace;
    }

    html { scroll-behavior: smooth; font-size: 110%; }

    body {
      background: var(--bg);
      color: var(--sand);
      font-family: var(--font-m);
      font-size: 1rem;
      font-weight: 300;
      line-height: 1.8;
      /* FIX: overflow-x hidden on body breaks iOS scroll; apply to html instead */
      overflow-x: hidden;
    }

    html { overflow-x: hidden; }

    /* FIX: Only hide cursor and apply custom cursor on non-touch devices */
    @media (pointer: fine) {
      body { cursor: none; }
      html, body { cursor: none; }
      a, button, [role="button"], input, textarea { cursor: none !important; }
    }

    /* FIX: On touch devices, restore normal cursor behaviour */
    @media (pointer: coarse) {
      body { cursor: auto; }
      a, button, [role="button"] { cursor: pointer; }
      input, textarea { cursor: text; }
      #cursor { display: none !important; }
    }

    .hero-eyebrow, .s-num, .about-label, .cv-group-title, .b-tag,
    .tl-date, .social-item span, .about-stat-label, .b-link {
      color: var(--rust);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.25em;
      font-size: 0.75rem;
    }

    /* CURSOR — only rendered on pointer:fine via JS anyway, but keep styles */
    #cursor {
      position: fixed;
      width: 18px;
      height: 18px;
      border: 2px solid var(--rust);
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      transition: transform .15s ease-out, background .2s ease;
    }
    #cursor.cursor-hover {
      transform: translate(-50%, -50%) scale(1.8);
      background: var(--rust-dim);
    }
    #cursor::after {
      content: "";
      position: absolute;
      top: 50%; left: 50%;
      width: 4px; height: 4px;
      background: var(--rust);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    body::after {
      content:''; position:fixed; inset:0; pointer-events:none; z-index:9997; opacity:.035;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
    }

    section { position:relative; z-index:1; }
    .wrap { max-width:1200px; margin:0 auto; padding:0 clamp(2rem,5vw,5rem); }

    /* HERO */
    #hero { padding:clamp(6rem,15vh,12rem) 0 6rem; }
    .hero-inner { display:flex; align-items:center; justify-content:space-between; gap:4rem; }
    .hero-main { flex:1 1 0; min-width:0; }
    .hero-eyebrow { margin-bottom:2.5rem; opacity:0; animation:up .9s .2s cubic-bezier(.16,1,.3,1) forwards; word-break: break-word; overflow-wrap: break-word; }
    .hero-name { font-family:var(--font-s); font-size:clamp(4rem,10vw,9.5rem); font-weight:400; line-height:.85; color:var(--sand); opacity:0; animation:up .9s .35s cubic-bezier(.16,1,.3,1) forwards; }
    .hero-name span { display:block; font-style:italic; color:rgba(232,220,200,.55); font-size:.72em; }
    .hero-photo-wrap { flex:0 0 clamp(220px,32vw,450px); opacity:0; animation:up .9s .5s cubic-bezier(.16,1,.3,1) forwards; }
    .hero-photo { width:100%; border:1px solid var(--border); border-radius:3px; overflow:hidden; }
    .hero-photo img { width:100%; height:auto; display:block; }

    /* PROJECT MODAL */
    .proj-overlay {
      position:fixed; inset:0;
      background:rgba(22,18,14,.92);
      z-index:800;
      display:flex; align-items:center; justify-content:center;
      /* FIX: add padding for safe area on notched phones */
      padding:env(safe-area-inset-top, 1rem) env(safe-area-inset-right, 1rem) env(safe-area-inset-bottom, 1rem) env(safe-area-inset-left, 1rem);
      padding: max(env(safe-area-inset-top), 1rem) max(env(safe-area-inset-right), 1rem) max(env(safe-area-inset-bottom), 1rem) max(env(safe-area-inset-left), 1rem);
      opacity:0; pointer-events:none;
      transition:opacity .35s;
      /* FIX: prevent scroll bleed-through on iOS */
      -webkit-overflow-scrolling: touch;
    }
    .proj-overlay.active { opacity:1; pointer-events:all; }

    .proj-nav {
      position:absolute; top:50%; transform:translateY(-50%);
      width:48px; height:48px;
      background:var(--charcoal); border:1px solid var(--border); border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:1.25rem; color:var(--sand-dim);
      transition:all .25s; z-index:10;
    }
    .proj-nav:hover { background:var(--rust); border-color:var(--rust); color:#fff; }
    .proj-nav:disabled { opacity:.18; pointer-events:none; }
    .proj-nav.prev { left:max(1.5rem, calc(50% - 390px - 72px)); }
    .proj-nav.next { right:max(1.5rem, calc(50% - 390px - 72px)); }

    .proj-modal {
      background:var(--bg2); border:1px solid var(--border); border-radius:4px;
      width:90%; max-width:780px;
      /* FIX: use dvh (dynamic viewport height) which accounts for browser chrome on mobile */
      max-height:85vh;
      max-height:85dvh;
      overflow-y:auto; position:relative;
      transform:translateY(24px) scale(.98);
      transition:transform .4s cubic-bezier(.16,1,.3,1);
      scrollbar-width:thin; scrollbar-color:var(--charcoal) transparent;
      /* FIX: enable momentum scrolling inside modal on iOS */
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    .proj-overlay.active .proj-modal { transform:none; }

    .proj-modal-header {
      position:sticky; top:0; z-index:20;
      display:flex; justify-content:space-between; align-items:center;
      padding:.9rem 1.4rem;
      background:var(--bg2); border-bottom:1px solid var(--border);
    }
    .proj-swipe-hint {
      display: none;
      font-size: .62rem; color: var(--sand-dim); letter-spacing: .15em;
      text-transform: uppercase; opacity: .6;
    }
    @media (pointer: coarse) {
      .proj-swipe-hint { display: block; }
    }
    .proj-counter { font-size:.68rem; color:var(--rust); font-weight:700; letter-spacing:.22em; text-transform:uppercase; }
    .proj-modal-close {
      width:36px; height:36px; border-radius:50%;
      background:var(--charcoal); border:1px solid var(--border);
      font-size:1rem; color:var(--sand-dim);
      display:flex; align-items:center; justify-content:center;
      transition:all .2s;
      /* FIX: ensure tap target is large enough on mobile (44×44px minimum) */
      min-width:44px; min-height:44px;
    }
    .proj-modal-close:hover { background:var(--rust); border-color:var(--rust); color:#fff; }

    .proj-modal-body { padding:2.8rem 3rem 3.5rem; }

    .proj-modal-tag { color:var(--rust); font-weight:700; text-transform:uppercase; letter-spacing:.25em; font-size:.7rem; margin-bottom:1rem; }
    .proj-modal-title { font-family:var(--font-s); font-size:clamp(1.6rem,3vw,2.4rem); color:var(--sand); line-height:1.15; margin-bottom:.5rem; }
    .proj-modal-year { font-size:.82rem; color:var(--sand-dim); margin-bottom:2.5rem; padding-bottom:2rem; border-bottom:1px solid var(--border); }

    .proj-modal-content p { font-size:1rem; color:var(--sand-dim); line-height:1.95; margin-bottom:1.5em; }
    .proj-modal-content p strong { color:var(--sand); font-weight:400; }
    .proj-modal-content h3 { font-family:var(--font-s); font-size:1.25rem; color:var(--sand); font-weight:400; margin:2.5rem 0 .8rem; }

    .proj-modal-content .pm-img {
      width:100%; display:block;
      border:1px solid var(--border); border-radius:3px;
      margin:2rem 0; background:var(--charcoal);
    }
    .proj-modal-content .pm-img img { width:100%; display:block; border-radius:2px; }
    .proj-modal-content .pm-img.placeholder {
      aspect-ratio:16/7;
      display:flex; align-items:center; justify-content:center;
      font-size:.68rem; color:var(--sand-dim);
      text-transform:uppercase; letter-spacing:.12em;
    }
    .proj-modal-content .pm-caption {
      font-size:.75rem; color:var(--sand-dim);
      text-align:center; margin-top:-1.5rem; margin-bottom:2rem;
      font-style:italic; letter-spacing:.03em;
    }
    .proj-modal-content .pm-img-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin:2rem 0 .5rem; }
    .proj-modal-content .pm-img-row .pm-img { margin:0; }

    .proj-modal-content .pm-links {
      display:flex; flex-wrap:wrap; gap:.8rem;
      margin-top:2.5rem; padding-top:2rem; border-top:1px solid var(--border);
    }
    .proj-modal-content .pm-links a {
      color:var(--rust); font-weight:700; text-transform:uppercase;
      letter-spacing:.2em; font-size:.72rem; text-decoration:none;
      border:1px solid var(--rust-dim); padding:.5rem 1.2rem; border-radius:2px;
      transition:all .25s;
      /* FIX: minimum tap target */
      min-height:44px; display:inline-flex; align-items:center;
    }
    .proj-modal-content .pm-links a:hover { background:var(--rust); color:#fff; border-color:var(--rust); }

    /* CONTACT MODAL */
    .modal-overlay { position:fixed; inset:0; background:rgba(22,18,14,.85); z-index:810; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity .35s; }
    .modal-overlay.active { opacity:1; pointer-events:all; }
    .modal {
      background:var(--bg2); border:1px solid var(--border); border-radius:4px; padding:2.8rem;
      width:90%; max-width:480px;
      /* FIX: allow modal to scroll if viewport is short (e.g. landscape mobile) */
      max-height:90vh; max-height:90dvh; overflow-y:auto;
      -webkit-overflow-scrolling: touch;
      position:relative;
      transform:translateY(20px); transition:transform .35s cubic-bezier(.16,1,.3,1);
    }
    .modal-overlay.active .modal { transform:none; }
    .modal-close {
      position:absolute; top:1.2rem; right:1.5rem; font-size:1.5rem; color:var(--sand-dim);
      background:none; border:none;
      /* FIX: tap target */
      min-width:44px; min-height:44px; display:flex; align-items:center; justify-content:center;
    }
    .modal h3 { font-family:var(--font-s); font-size:1.8rem; color:var(--sand); margin-bottom:.5rem; }
    .form-row { display:flex; flex-direction:column; gap:1rem; margin-bottom:1.2rem; }
    .form-row input, .form-row textarea {
      background:var(--charcoal); border:1px solid var(--border); padding:.8rem; color:var(--sand);
      font-family:var(--font-m); outline:none; border-radius:2px;
      /* FIX: font-size 16px prevents iOS Safari from auto-zooming on focus */
      font-size:16px;
    }
    .form-submit {
      width:100%; padding:1rem; background:var(--rust); color:#fff; border:none;
      font-family:var(--font-m); text-transform:uppercase; letter-spacing:.2em; border-radius:2px;
      font-size:16px;
      /* FIX: minimum tap target height */
      min-height:44px;
    }

    /* SECTIONS */
    .s-head { display:flex; align-items:baseline; gap:1.5rem; margin-bottom:5rem; }
    .s-title { font-family:var(--font-s); font-size:clamp(2.2rem,4vw,3.2rem); font-weight:400; color:var(--sand); line-height:1; }

    /* ABOUT */
    #about { padding:6rem 0; }
    .about-grid { display:grid; grid-template-columns:1fr 1.6fr; gap:clamp(3rem,8vw,8rem); align-items:start; }
    .about-location { font-size:1rem; color:var(--sand-dim); margin-bottom:2.5rem; }
    .about-stat { border-top:1px solid var(--border); padding:1.5rem 0; display:flex; flex-direction:column; gap:.2rem; }
    .about-stat-num { font-family:var(--font-s); font-size:2.5rem; color:var(--sand); line-height:1; }
    .about-right p { font-size:1.05rem; color:var(--sand-dim); line-height:1.9; margin-bottom:1.5em; }
    .about-right p strong { color:var(--sand); }
    .tags { display:flex; flex-wrap:wrap; gap:.6rem; margin-top:2.5rem; }
    .tag {
      font-size:.7rem; letter-spacing:.1em; text-transform:uppercase; padding:.4rem .9rem;
      border:1px solid var(--border); color:var(--sand-dim); transition:all .3s;
      /* FIX: minimum tap target */
      min-height:36px; display:inline-flex; align-items:center;
    }
    .tag:hover { border-color:var(--rust); color:var(--rust); }

    /* PROJECTS GRID */
    #projects { padding:6rem 0; }
    .bubbles { display:grid; grid-template-columns:1fr 1fr; gap:1px; background:var(--border); border:1px solid var(--border); }
    .bubbles.odd-count .bubble:first-child { grid-column:1 / -1; }

    .bubble { background:var(--bg); padding:2.5rem; transition:background .3s; position:relative; overflow:hidden; }
    .bubble:hover { background:var(--bg2); }
    /* FIX: active state for touch feedback */
    .bubble:active { background:var(--bg2); }
    .bubble::after { content:''; position:absolute; bottom:0; left:0; right:0; height:2px; background:var(--rust); transform:scaleX(0); transition:transform .4s cubic-bezier(.16,1,.3,1); }
    .bubble:hover::after { transform:scaleX(1); }

    .b-thumb-ph { width:100%; background:var(--charcoal); margin-bottom:1.5rem; display:flex; align-items:center; justify-content:center; font-size:.7rem; color:var(--sand-dim); text-transform:uppercase; letter-spacing:.1em; border-radius:2px; overflow:hidden; }
    .b-thumb-ph:not(:has(img)) { aspect-ratio:16/7; }
    .b-thumb-ph img { width:100%; height:auto; display:block; }

    .b-title { font-family:var(--font-s); font-size:1.4rem; color:var(--sand); margin-bottom:.4rem; }
    .b-year { font-size:.8rem; color:var(--sand-dim); }

    /* EXPERIENCE */
    #cv { padding:6rem 0; }
    .cv-cols { display:grid; grid-template-columns:1fr 1fr; gap:5rem; }
    .cv-group-title { margin-bottom:2.5rem; padding-bottom:1rem; border-bottom:1px solid var(--border); }
    .tl-item { display:grid; grid-template-columns:110px 1fr; gap:2rem; padding:2rem 0; border-bottom:1px solid var(--border); }
    .tl-title { font-family:var(--font-s); font-size:1.25rem; color:var(--sand); margin-bottom:.4rem; line-height:1.3; }
    .tl-org { font-size:.95rem; color:var(--sand-dim); font-style:italic; margin-bottom:.5rem; }
    .tl-note { font-size:.95rem; color:var(--sand-dim); line-height:1.7; }
    .btn-cv {
      display:inline-flex; align-items:center; gap:.8rem; font-size:.8rem; letter-spacing:.2em;
      text-transform:uppercase; color:var(--sand); text-decoration:none; border:1px solid var(--border);
      padding:1rem 2rem; transition:all .3s; margin-top:4rem;
      /* FIX: minimum tap target */
      min-height:44px;
    }
    .btn-cv:hover { background:var(--rust); color:#fff; border-color:var(--rust); }

    /* CONTACT */
    #contact { padding:6rem 0 10rem; }
    .contact-inner { display:grid; grid-template-columns:1fr 1fr; gap:6rem; align-items:end; }
    .contact-left p { font-size:1.1rem; color:var(--sand-dim); margin-bottom:2.5rem; }
    .btn-rust {
      font-family:var(--font-m); font-size:.8rem; padding:1rem 2.2rem; background:var(--rust);
      color:var(--bg); border:none; text-transform:uppercase; font-weight:bold; letter-spacing:.15em;
      border-radius:2px;
      /* FIX: minimum tap target */
      min-height:44px;
    }
    .social-item {
      display:flex; justify-content:space-between; align-items:center; padding:1.5rem 0;
      border-bottom:1px solid var(--border); width:100%; background:none;
      border-top:none; border-left:none; border-right:none; color:var(--sand-dim);
      font-family:var(--font-m); font-size:1.1rem; text-align:left;
      /* FIX: minimum tap target */
      min-height:56px;
    }
    .social-item:first-child { border-top:1px solid var(--border); }
    .social-item:hover { color:var(--sand); }
    /* FIX: active state for touch */
    .social-item:active { color:var(--sand); }

    /* FIX: footer — was hardcoded 5rem horizontal padding, breaking on mobile */
    footer {
      border-top:1px solid var(--border);
      padding:3rem clamp(2rem,5vw,5rem);
      display:flex; justify-content:space-between; flex-wrap:wrap; gap:1rem;
    }
    footer p { font-size:.8rem; color:var(--sand-dim); }

    .reveal { opacity:0; transform:translateY(30px); transition:all .8s cubic-bezier(.16,1,.3,1); }
    .reveal.in { opacity:1; transform:none; }
    @keyframes up { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:none} }

    /* ── MOBILE BREAKPOINT ── */
    @media (max-width:900px) {
      .wrap { padding:0 1.5rem; }
      .about-grid,.cv-cols,.contact-inner { grid-template-columns:1fr; gap:4rem; }
      .hero-inner { flex-direction:column-reverse; text-align:center; }
      /* FIX: tighten eyebrow letter-spacing so it fits without overflow */
      .hero-eyebrow { letter-spacing: 0.12em; font-size: 0.68rem; }
      /* FIX: centre the eyebrow text when hero is column-reversed */
      .hero-eyebrow { text-align:center; }
      .hero-photo-wrap { width:clamp(200px,60vw,350px); }
      .bubbles { grid-template-columns:1fr; }
      .bubbles.odd-count .bubble:first-child { grid-column:1; }
      /* FIX: reduce bubble padding on small screens */
      .bubble { padding:1.5rem; }
      .proj-modal-body { padding:1.5rem 1.25rem 2.5rem; }
      .proj-modal-content .pm-img-row { grid-template-columns:1fr; }
      .proj-nav { display:none; }
      /* FIX: tl-item date column was overflowing at narrow widths */
      .tl-item { grid-template-columns:80px 1fr; gap:1rem; }
      /* FIX: ensure s-head doesn't overflow */
      .s-head { flex-wrap:wrap; gap:.75rem; margin-bottom:3rem; }
      /* FIX: contact section bottom padding was too large on small screens */
      #contact { padding:4rem 0 6rem; }
    }

    /* FIX: extra small screens */
    @media (max-width:380px) {
      .tl-item { grid-template-columns:1fr; gap:.5rem; }
      .tl-date { font-size:.7rem; }
      .hero-name { font-size:clamp(3rem,18vw,4.5rem); }
    }
  </style>
</head>
<body>

<!-- FIX: cursor only injected when pointer:fine (mouse) detected via JS -->
<div id="cursor"></div>

<!-- PROJECT MODAL -->
<div class="proj-overlay" id="projOverlay" onclick="overlayClick(event)">
  <button class="proj-nav prev" id="projPrev" onclick="navProj(-1)" aria-label="Previous">&#8592;</button>
  <button class="proj-nav next" id="projNext" onclick="navProj(+1)" aria-label="Next">&#8594;</button>
  <div class="proj-modal" id="projModal">
    <div class="proj-modal-header">
      <span class="proj-counter" id="projCounter"></span>
      <span class="proj-swipe-hint">← swipe →</span>
      <button class="proj-modal-close" onclick="closeProjModal()" aria-label="Close">&#x2715;</button>
    </div>
    <div class="proj-modal-body">
      <div class="proj-modal-tag"     id="projModalTag"></div>
      <div class="proj-modal-title"   id="projModalTitle"></div>
      <div class="proj-modal-year"    id="projModalYear"></div>
      <div class="proj-modal-content" id="projModalContent"></div>
    </div>
  </div>
</div>

<!-- CONTACT MODAL -->
<div class="modal-overlay" id="contactModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">×</button>
    <h3>Get in touch</h3>
    <form id="contactForm" action="https://formspree.io/f/YOUR_FORM_ID" method="POST" onsubmit="handleSubmit(event)">
      <div class="form-row">
        <input type="text"  name="name"    placeholder="Your name"    required />
        <input type="email" name="email"   placeholder="Your email"   required />
        <textarea name="message" rows="5"  placeholder="Your message" required></textarea>
      </div>
      <button class="form-submit" type="submit">Send Message</button>
    </form>
    <div id="formSuccess" style="display:none;text-align:center;padding-top:1rem;color:var(--rust);">
      Thanks for reaching out — I'll be in touch.
    </div>
  </div>
</div>

<!-- PAGE -->
<section id="hero">
  <div class="wrap">
    <div class="hero-inner">
      <div class="hero-main">
        <p class="hero-eyebrow">Data Scientist · Astrophysicist · Statistical Modelling · Algorithm Optimization · Data Engineering</p>
        <h1 class="hero-name">Nicolò <span>Dalmasso</span></h1>
      </div>
      <div class="hero-photo-wrap">
        <div class="hero-photo"><img src="images/ND_pic.jpg" alt="Nicolò Dalmasso"></div>
      </div>
    </div>
  </div>
</section>

<section id="about">
  <div class="wrap">
    <div class="s-head reveal"><span class="s-num">01</span><h2 class="s-title">About</h2></div>
    <div class="about-grid">
      <div class="about-left reveal">
        <p class="about-label">Based in</p>
        <p class="about-location">Melbourne, Australia</p>
        <div class="about-stat"><span class="about-stat-num">7</span><span class="about-stat-label">Peer-reviewed publications</span></div>
        <div class="about-stat"><span class="about-stat-num">5</span><span class="about-stat-label">First-author papers</span></div>
        <div class="about-stat"><span class="about-stat-num">4+</span><span class="about-stat-label">Quantitative research</span></div>
      </div>
      <div class="about-right reveal">
        <p>Astrophysicist turned data scientist, with a background in <strong>galaxy clustering</strong> and <strong>large-scale statistical modelling</strong>. I spent my PhD mapping the connection between massive galaxies and dark matter halos, then decided the Universe could wait and brought those skills somewhere with a shorter feedback loop.</p>
        <p>Now working on <strong>next-generation AI models</strong>, contributing to training data quality, evaluation frameworks, and the kind of analytical work that actually makes models less wrong.</p>
        <p>Outside of that: I cook obsessively, keep aquariums that are definitely too ambitious, lose sleep over <strong>Magic: The Gathering</strong>, and will drop everything for a <strong>remote trail, a long flight, or a campsite with no signal</strong>. If any of that sounds like your kind of person, get in touch.</p>
        <div class="tags">
          <span class="tag">Python</span><span class="tag">Bayesian Inference</span><span class="tag">MCMC</span><span class="tag">NumPy · Pandas</span><span class="tag">SQL</span><span class="tag">Docker</span><span class="tag">Git</span><span class="tag">ML</span><span class="tag">LLM Evaluation</span><span class="tag">ETL Pipelines</span><span class="tag">Data Visualization</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- PROJECTS — grid is built from the projects array in the script below -->
<section id="projects">
  <div class="wrap">
    <div class="s-head reveal"><span class="s-num">02</span><h2 class="s-title">Projects</h2></div>
    <p class="about-location">This is where I keep things. Research, side projects, work in progress. Updated as I go.</p>
    <div class="bubbles reveal" id="bubblesGrid"></div>
  </div>
</section>

<section id="cv">
  <div class="wrap">
    <div class="s-head reveal"><span class="s-num">03</span><h2 class="s-title">Experience</h2></div>
    <div class="cv-cols">
      <div class="reveal">
        <p class="cv-group-title">Work</p>
        <div class="tl">
          <div class="tl-item">
            <div class="tl-date">Sep 2025<br/>Present</div>
            <div>
              <div class="tl-title">LLM Training Specialist</div>
              <div class="tl-org">Mercor Intelligence</div>
              <div class="tl-note">Designing advanced STEM problems and evaluation frameworks to improve the reasoning capabilities of frontier AI models.</div>
            </div>
          </div>
          <div class="tl-item">
            <div class="tl-date">Mar 2022<br/>Sep 2025</div>
            <div>
              <div class="tl-title">Doctoral Researcher</div>
              <div class="tl-org">University of Melbourne</div>
              <div class="tl-note">Studied galaxy formation using JWST and Hubble data, building statistical pipelines and leading international collaborations.</div>
            </div>
          </div>
          <div class="tl-item">
            <div class="tl-date">Mar 2022<br/>Sep 2025</div>
            <div>
              <div class="tl-title">Teaching Assistant</div>
              <div class="tl-org">University of Melbourne</div>
              <div class="tl-note">Delivered tutorials in Physics and Astrophysics, and contributed to outreach programs.</div>
            </div>
          </div>
        </div>
      </div>
      <div class="reveal">
        <p class="cv-group-title">Education</p>
        <div class="tl">
          <div class="tl-item">
            <div class="tl-date">2022<br/>2025</div>
            <div><div class="tl-title">PhD in Physics — Astrophysics</div><div class="tl-org">University of Melbourne, AU</div></div>
          </div>
          <div class="tl-item">
            <div class="tl-date">2019<br/>2021</div>
            <div>
              <div class="tl-title">MSc in Astrophysics &amp; Theoretical Physics</div>
              <div class="tl-org">Università degli Studi di Torino, IT</div>
              <div class="tl-note">110/110 with distinction</div>
            </div>
          </div>
          <div class="tl-item">
            <div class="tl-date">2016<br/>2019</div>
            <div><div class="tl-title">BSc in Physics</div><div class="tl-org">Università degli Studi di Torino, IT</div></div>
          </div>
        </div>
      </div>
    </div>
    <div class="reveal">
      <a href="files/Nicolo_Dalmasso_CV.pdf" download class="btn-cv">Download Full CV</a>
    </div>
  </div>
</section>

<section id="contact">
  <div class="wrap">
    <div class="s-head reveal"><span class="s-num">04</span><h2 class="s-title">Contact</h2></div>
    <div class="contact-inner">
      <div class="contact-left reveal">
        <p>Always happy to talk science, data, or anything in between.</p>
        <button class="btn-rust" onclick="openModal()">Send a Message</button>
      </div>
      <div class="contact-right reveal">
        <button class="social-item" onclick="goLink('gh')">GitHub <span>Profile ↗</span></button>
        <button class="social-item" onclick="goLink('li')">LinkedIn <span>Profile ↗</span></button>
        <button class="social-item" onclick="goLink('gs')">Google Scholar <span>Publications ↗</span></button>
      </div>
    </div>
  </div>
</section>

<footer><p>© 2025 Nicolò Dalmasso</p></footer>

<script>
/* ── CURSOR — only activate on non-touch (pointer:fine) devices ── */
const isTouchDevice = window.matchMedia('(pointer: coarse)').matches;
const cur = document.getElementById('cursor');

if (!isTouchDevice) {
  document.addEventListener('mousemove', e => {
    cur.style.left = e.clientX + 'px';
    cur.style.top  = e.clientY + 'px';
  });
  document.querySelectorAll('a, button, .bubble, .social-item, .btn-cv, .btn-rust').forEach(el => {
    el.addEventListener('mouseenter', () => cur.classList.add('cursor-hover'));
    el.addEventListener('mouseleave', () => cur.classList.remove('cursor-hover'));
  });
} else {
  /* Hide cursor element entirely on touch devices */
  cur.style.display = 'none';
}

/* ── REVEAL ── */
const obs = new IntersectionObserver(es => es.forEach(e => { if (e.isIntersecting) e.target.classList.add('in'); }), { threshold: .1 });
document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

/* ── LINKS ── */
const links = {
  gh:               atob('aHR0cHM6Ly9naXRodWIuY29tL25kYWxtYXNzbw=='),
  li:               atob('aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL25pY29sby1kYWxtYXNzby8='),
  gs:               atob('aHR0cHM6Ly9zY2hvbGFyLmdvb2dsZS5jb20vY2l0YXRpb25zP3VzZXI9Tjl3clJuUUFBQUomaGw9ZW4='),
  acf_code:         atob('aHR0cHM6Ly9naXRodWIuY29tL25kYWxtYXNzby9hY2YtZ2FsYXh5LWNsdXN0ZXJpbmc='),
  spectra_fit_code: atob('aHR0cHM6Ly9naXRodWIuY29tL25kYWxtYXNzby9zcGVjdHJhLWZpdHRpbmc='),
  aria_code:        atob('aHR0cHM6Ly9naXRodWIuY29tL25kYWxtYXNzby9BUklBX0FkYXB0aXZlX1J1bm5pbmdfSW50ZWxsaWdlbnRfQXNzaXN0YW50'),
  p1: atob('aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL21ucmFzL2FydGljbGUvNTI4LzEvODk4Lzc0ODAyNTg='),
  p2: atob('aHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9zNDE1NTAtMDI0LTAyMjE4LTc='),
  p3: atob('aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL21ucmFzL2FydGljbGUvNTMzLzIvMjM5MS83NzM4Mzkw'),
  p4: atob('aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL21ucmFzL2FydGljbGUvNTMzLzQvNDQ3Mi83NzQ4NzU2'),
  p5: atob('aHR0cHM6Ly93d3cuYWFuZGEub3JnL2FydGljbGVzL2FhL2Ficy8yMDI1LzA3L2FhNTQ5NTQtMjUvYWE1NDk1NC0yNS5odG1s'),
  p6: atob('aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL21ucmFzL2FydGljbGUvNTQ2LzIvc3RhZzAwMS84NDE0MDUy'),
  p7: atob('aHR0cHM6Ly9hY2FkZW1pYy5vdXAuY29tL21ucmFzL2FydGljbGUvNTQ0LzIvMTkxNS84MzAwODA4')
};
function goLink(k)       { window.open(links[k], '_blank'); }
function openLink(e, k)  { e.stopPropagation(); window.open(links[k], '_blank'); }

/* ═══════════════════════════════════════════════════════
   PROJECT DATA
   ═══════════════════════════════════════════════════════ */
const projects = [

  /* Galaxy Clustering */
  {
    tag:     'Galaxy Clustering · HST · JWST · 2022–2025',
    title:   'From HST to JWST: Pushing Galaxy Clustering to the Edge of the Observable',
    year:    'What Galaxy Clustering Really Tells Us About Dark Matter.',
    thumb:   'images/ACF_HOD.png',
    visible: true,
    content: `
      <p>
          · How far can we really push clustering measurements at high redshift?<br>
          · How deep can we go before the signal becomes uncertain?<br>
          · Can we meaningfully probe the faint end of the luminosity function?<br><br>

          This figure is the result of more than three years working on galaxy clustering in the early Universe.
          It brings together survey design, modelling, calibration and validation, moving from the depth of the
          <strong>Hubble Space Telescope (HST)</strong> to what the <strong>James Webb Space Telescope (JWST)</strong> now makes possible through a
          <strong>Halo Occupation Distribution (HOD)</strong> model.
      </p>

      <div class="pm-img"><img src="images/ACF_HOD.png"></div>
      <p class="pm-caption">
          Measured ACFs in the GOODS-S field at six mean redshifts.
          The blue line shows the HOD best fit, with one-halo and two-halo contributions separated.
          Magnitude thresholds and mean redshifts are indicated in each panel.
      </p>

      <h3>Galaxy Clustering!?</h3>
      <p>
          Imagine you walk into a pub and notice your group of friends has naturally gathered at one end of the bar,
          while another group has settled at the other. You are not randomly scattered around the room, you are <strong>clustered</strong>.
          Now zoom out to the scale of the Universe, swap people for galaxies, and swap the pub for hundreds of millions
          of light years of space. <strong>Galaxy clustering</strong> measures exactly that tendency: how strongly galaxies clump together
          beyond what pure chance would predict. The stronger the clustering signal, the more massive the <strong>dark matter halos</strong>
          those galaxies tend to live in, and the more we can infer about the <strong>cosmic scaffolding</strong> that pulled them together
          in the first place.
      </p>
      <p>
          The starting point was understanding how <strong>depth and completeness</strong> shape clustering measurements.
          Using HST data from the heterogeneous <strong>GOODS North and South</strong> fields, we developed a method to account
          for spatial variations when recovering <strong>high redshift candidates</strong>. This enabled consistent clustering
          measurements across non-uniform data, with particular attention to the <strong>faint end of the luminosity function</strong>.
      </p>

      <div style="text-align:center; margin: 2rem 0;">
          <img src="images/GOODSN_rms.png" style="width:60%; height:auto;">
          <p style="margin-top:0.5rem; font-size:0.9rem; color:#555;">Depth variations across the GOODS-North field.</p>
      </div>

      <p>
          With the arrival of JWST, the question evolved. The same framework could now be pushed to <strong>fainter
          magnitudes and earlier cosmic times</strong>. The result was a clustering analysis capable of measuring <strong>galaxy
          bias beyond redshift z = 10</strong>, offering a direct view of structure formation when the Universe was less than
          <strong>a billion years old</strong>.
      </p>

      <div class="pm-img"><img src="images/ACF_ALL_app_mag_cut.png"></div>
      <p class="pm-caption">Angular correlation functions measured across six redshift bins with power law fits.</p>

      <h3>Key Results</h3>
      <p>
          The final step was a physical interpretation through an <strong>HOD model</strong> fitted to the latest JWST data.
          The clustering signal implies <strong>dark matter halo masses of 10¹¹ to 10¹² solar masses</strong> at redshift z = 7–11.
          Even at these early times, massive galaxies already appear to reside in <strong>substantial dark matter halos</strong>.
      </p>

      <div class="pm-img"><img src="images/fsat_beff_Mh_vs_z.png"></div>
      <p class="pm-caption">Evolution of satellite fraction, effective galaxy bias and characteristic halo mass with redshift.</p>

      <p> 
        The ACF estimator used in this work is openly available on GitHub. Papers and code linked below.
      </p>

      <div class="pm-links">
          <a href="#" onclick="openLink(event,'p1')">HST Clustering paper →</a>
          <a href="#" onclick="openLink(event,'p3')">JWST Clustering paper →</a>
          <a href="#" onclick="openLink(event,'p6')">HOD Modelling paper →</a>
          <a href="#" onclick="openLink(event,'acf_code')">ACF Clustering code →</a>
      </div>
    `
  },


  /* ARIA */
  {
    tag:     'ARIA · AI · ML · 2025',
    title:   'ARIA - Adaptive Running Intelligent Assistant',
    year:    "Your playlist doesn't know you're dying at kilometre three. ARIA does.",
    thumb:   'images/aria_recap.png',
    visible: true,
    content: `
      <p>
          Can a running app actually listen to you?<br>
          Spoiler: they can't. ARIA can.<br><br>

          <strong>ARIA (Adaptive Running Intelligent Assistant)</strong> started as a question I kept asking while grinding through
          the same static playlist with a training plan that had absolutely no idea I was running on four hours of sleep.
          It turned into a small <strong>Python project</strong> to see if a coaching system could genuinely respond to you in real time,
          not just log your splits and move on.
      </p>

      <h3>The Problem with Running Apps</h3>
      <p>
          Despite the explosion of running apps and wearables, the core experience has barely changed. You are
          treated like a <strong>set of statistics</strong>. Playlists are fixed before you leave the door, training plans are built
          around <strong>population averages</strong> and have no idea how you feel at kilometre four, and when a session falls apart
          or goes better than expected there is no way for any of that to <strong>feed back</strong> into what happens next. Every run
          starts from the same baseline, regardless of what the last ten told you.
      </p>
      <p>
          Music is the piece that always felt the most wasted. There is solid evidence linking <strong>tempo, energy and BPM</strong>
          to <strong>perceived exertion and performance output</strong>, and yet every app treats it as background noise. A well-timed
          track at the right BPM can carry you through a hard interval better than any notification telling you to
          push harder. ARIA takes that seriously.
      </p>

      <h3>How ARIA Works</h3>
      <p>
          The idea is to build a coach that knows where you are <strong>right now</strong>, not where a plan assumed you would be.
          You start with a <strong>personal profile</strong>: basic stats feed into personalised <strong>heart rate zones</strong> and optimal <strong>BPM
          ranges</strong> for each training zone, so the system is grounded in your physiology from the start. From there,
          a <strong>music engine</strong> selects and swaps tracks based on BPM and energy level, matching your current zone and
          nudging intensity up or down as needed. The whole thing is held together by a <strong>real-time feedback loop</strong>:
          inputs signal whether you are pushing hard, struggling or comfortable, and ARIA adjusts both
          the training prescription and the music on the spot.
      </p>

      <div class="pm-img"><img src="images/aria_config.png"></div>
      <p class="pm-caption">
          Setup and pre-run planning. ARIA takes your runner profile and builds a personalised session,
          mapping training zones to musical BPM ranges that will guide workout intensity from the first step.
      </p>

      <p>
          The demo runs as an interactive notebook. After configuring your profile and generating your zones,
          a simulated run lets you feed in live state signals: <strong>UP</strong> if you are feeling strong and ready for more,
          <strong>DOWN</strong> if you need to ease off, <strong>OK</strong> if the current pace is right. ARIA reacts immediately, shifting the
          training zone and pulling in music that matches where you actually are.
      </p>

      <div class="pm-img"><img src="images/aria_example_run.png"></div>
      <p class="pm-caption">
          Live adaptation in action. Real-time feedback triggers immediate adjustments to both training zone
          and music selection, responding to your actual state rather than a predetermined schedule.
      </p>

      <p>
          The post-run step closes the loop. Feedback from the session gets <strong>logged against your profile</strong>,
          so future runs start from a more informed place and the system gradually builds a picture of your
          <strong>patterns, preferences</strong> and how you respond to different intensities and sounds.
      </p>

      <div class="pm-img"><img src="images/aria_recap.png"></div>
      <p class="pm-caption">
          Post-run feedback helps ARIA refine its understanding of your patterns and preferences,
          so each session informs the next.
      </p>

      <p>
          ARIA is a <strong>proof of concept</strong>, not a finished product. The kind of small project that exists to test
          whether an idea holds together. The answer is that it mostly does. <strong>BPM-matched music</strong> combined with
          <strong>real-time zone adaptation</strong> makes for a genuinely different feel compared to a fixed playlist and a
          rigid plan. The open question that sticks with me is how much of that comes from the science,
          and how much comes from simply <strong>feeling like something is paying attention</strong>.
      </p>

      <p>
          The full demo and code are on GitHub, linked below       
      </p>

      <div class="pm-links">
          <a href="#" onclick="openLink(event,'aria_code')">ARIA demo and code →</a>
      </div>
    `
  },

  /* Slit Loss */
  {
    tag:     'Spectroscopy · Spectrographs · JWST · 2025',
    title:   'Slit Loss Corrections in JWST Spectroscopy',
    year:    'NIRISS vs NIRSpec a JWST showdown.',
    thumb:   'images/spectra_niriss.png',
    visible: true,
    content: `
      <p>
          · Can one use both spectroscopic data from NIRISS and from NIRSpec?<br>
          · Are they the same even if the instruments are different?<br><br>

          These are two questions that arose while working with the <strong>GLASS (Grism Lens-Amplified Survey from Space)</strong>
          collaboration during my visit as a research student at UCLA (University of California, Los Angeles).
          We were in the process of creating the <strong>first spectroscopic NIRISS catalogue</strong>, and these questions came up naturally.
          It was the perfect occasion to delve into them with a dedicated project, led by me.
      </p>

      <div class="pm-img"><img src="images/all_cutouts.png"></div>
      <p class="pm-caption">
          NIRISS imaging cutouts of the 12 galaxies in our sample. White contours show the segmentation maps,
          magenta and white rectangles mark the NIRSpec slits, and the "A" parameter in each panel indicates
          the fraction of the segmentation map covered by the slit. Objects span redshifts z = 1.27–3.38 and are
          classified as compact or extended based on their flux distribution relative to the slit geometry.
      </p>

      <h3>NIRISS and NIRSpec</h3>
      <p>
          <strong>JWST (James Webb Space Telescope)</strong> offers two complementary spectroscopic modes for studying distant galaxies.
          <strong>NIRISS WFSS (Near Infrared Imager and Slitless Spectrograph Wide Field Slitless Spectroscopy)</strong> disperses
          light across the entire field of view without spatial constraints, capturing the integrated emission from each
          galaxy's full morphological extent as defined by its segmentation map. <strong>NIRSpec MSA (Near Infrared Spectrograph
          Micro-Shutter Assembly)</strong> instead isolates individual targets through a micro-shutter array, with each slit
          measuring just <strong>0.2 × 0.46 arcsec</strong>, enabling simultaneous multi-object spectroscopy with minimised sky background
          and high spectral resolution.
      </p>
      <p>
          Both instruments are exceptional, but they work in <strong>fundamentally different ways</strong> and that difference matters.
          A slit can miss light. A slitless instrument cannot. The question is: how much does this actually affect the science?
          To find out, we selected <strong>12 spectroscopically confirmed galaxies</strong> from the <strong>Abell 2744</strong> cluster field, observed across
          three JWST programs: GLASS-JWST-ERS (PID 1324), JWST-DDT (PID 2756), and UNCOVER-JWST (PID 2561).
          These galaxies span <strong>redshifts z = 1.27–3.38</strong> and cover a range of morphologies, from compact point-like sources
          to large extended objects. For each, we measured strong emission lines — [O II] λ3727, Hβ λ4861,
          [O III] λ4959, [O III] λ5007, and Hα λ6563 — independently with both instruments and compared the results.
      </p>

      <h3>The Problem with Slits</h3>
      <p>
          When a narrow slit is placed over a galaxy, it only captures the light that falls within its footprint.
          For compact objects, this is rarely a problem. But for <strong>extended sources</strong>, a significant fraction of
          the emission lands outside the slit and is simply lost. These are called <strong>slit losses</strong>, and while the effect
          is well known in spectroscopy, its quantitative impact when combining JWST's slitless and slit-based
          modes <strong>had not been systematically characterised before this work</strong>.
      </p>
      <p>
          The <strong>morphology of a galaxy</strong> therefore becomes a critical variable. Two instruments observing the same
          object can return genuinely different flux measurements, not because of noise or calibration failures,
          but because of a <strong>real, physical difference in how much light each one collected</strong>. To quantify this, we fitted
          emission lines through <strong>χ² minimisation</strong> on 1D spectra from both instruments, using <strong>Monte Carlo (MC) sampling</strong>
          of the continuum regions around each line to obtain robust uncertainty estimates. We also made use of
          NIRISS emission line maps to simulate how much flux a randomly positioned NIRSpec slit would recover
          across <strong>10⁴ slit placements</strong> for each extended galaxy.
      </p>

      <div class="pm-img"><img src="images/spectra_niriss.png"></div>
      <p class="pm-caption">
          Example analysis for galaxy NIRISS ID 2744 at z = 1.86. Top right: the NIRISS spectrum (blue),
          original NIRSpec spectrum (gray), and NIRSpec convolved to match NIRISS resolution (red), with identified
          emission lines marked. Bottom panels: detailed MC emission line fits for each matched line, with shaded
          regions showing an example continuum estimation window from a single MC iteration.
      </p>

      <h3>Key Results</h3>
      <p>
          The analysis revealed a clear <strong>morphology-dependent dichotomy</strong>. Compact sources showed consistent flux
          measurements between instruments, with NIRSpec integrated fluxes comparable to or slightly exceeding NIRISS,
          all agreeing within <strong>1σ uncertainties</strong>. Extended sources behaved very differently: NIRISS systematically
          measured higher integrated fluxes, with NIRSpec consistently falling below, a direct signature of <strong>slit losses</strong>
          that was visible across all emission lines and all three observing programs.
      </p>
      <p>
          Using the emission line maps, we could quantify this effect directly. When the NIRSpec slit covered more
          than <strong>15% of the galaxy's segmentation map area</strong>, or when the effective radius was <strong>R<sub>e</sub> &lt; 1 kpc</strong>,
          NIRSpec recovered <strong>at least 63% of the NIRISS flux</strong>. For lower coverage fractions or more extended sources,
          that recovery dropped to anywhere between <strong>24% and 63%</strong>, a factor of four difference in the most extreme cases.
      </p>
      <p>
          <strong>Equivalent width (EW)</strong> measurements told a different story. Unlike flux ratios, which showed a stark
          compact/extended dichotomy, EW ratios were more scattered around zero for both morphological classes,
          with no persistent systematic offset for extended sources. Because EWs are defined relative to the <strong>local
          continuum</strong>, aperture-dependent losses in both the line and the continuum partially cancel out, making
          <strong>EW-based analyses more robust</strong> when combining data from different instruments.
      </p>
      <p>
          The most consequential finding concerns <strong>emission line ratios</strong>. We measured the <strong>Hα λ6563/[O III] λ5007</strong>
          ratio for four extended galaxies using multiple methods and found it varied by up to <strong>~0.3 dex</strong> across
          instruments and measurement approaches. That is large enough to shift derived <strong>metallicities and star
          formation rates</strong> meaningfully, particularly given that SFR estimates scale directly with Hα luminosity
          and that emission lines experience stronger <strong>dust attenuation</strong> than the continuum.
      </p>

      <div class="pm-img"><img src="images/flux_ratio_vs_restwave.png"><img src="images/flux_ratio_vs_area.png"></div>
      <p class="pm-caption">
          NIRSpec-to-NIRISS flux ratio as a function of rest-frame wavelength (top) and slit coverage fraction (bottom),
          with compact sources in blue and extended in red. Compact sources cluster near unity across all wavelengths,
          while extended sources with lower slit coverage show the strongest flux losses.
      </p>

      <p>
          As JWST datasets grow and <strong>multi-instrument catalogues</strong> become standard, establishing <strong>clear protocols</strong> for how
          to combine slitless and slit-based spectroscopy is becoming increasingly important. This project offers an
          <strong>empirical reference</strong> for exactly that, showing where the two instruments agree, where they diverge, and why.
      </p>

      <p>
          The emission line fitting pipeline behind this analysis is openly available on GitHub. Papers and code linked below.
      </p>

      <div class="pm-links">
          <a href="#" onclick="openLink(event,'p7')">Slit losses paper →</a>
          <a href="#" onclick="openLink(event,'spectra_fit_code')">Spectra fitting code →</a>
      </div>
    `
  }

];

/* ── BUILD BUBBLES ── */
const bubblesEl = document.getElementById('bubblesGrid');
const visibleProjects = projects.map((p, i) => ({ ...p, idx: i })).filter(p => p.visible);

visibleProjects.forEach(p => {
  const thumbHtml = p.thumb
    ? `<div class="b-thumb-ph"><img src="${p.thumb}"></div>`
    : `<div class="b-thumb-ph"></div>`;
  const div = document.createElement('div');
  div.className = 'bubble';
  div.setAttribute('role', 'button');
  div.setAttribute('tabindex', '0');
  div.onclick = () => openProj(p.idx);
  /* FIX: also handle keyboard Enter/Space for accessibility */
  div.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') openProj(p.idx); };
  div.innerHTML = `
    ${thumbHtml}
    <div class="b-tag">${p.tag}</div>
    <div class="b-title">${p.title}</div>
    ${p.year ? `<div class="b-year">${p.year}</div>` : ''}
  `;
  bubblesEl.appendChild(div);
});

if (visibleProjects.length % 2 !== 0) bubblesEl.classList.add('odd-count');

/* ── MODAL LOGIC ── */
let currentVisibleIdx = 0;

function openProj(idx) {
  currentVisibleIdx = visibleProjects.findIndex(p => p.idx === idx);
  renderProj();
  document.getElementById('projOverlay').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function renderProj() {
  const p = visibleProjects[currentVisibleIdx];
  document.getElementById('projCounter').textContent    = `${currentVisibleIdx + 1} / ${visibleProjects.length}`;
  document.getElementById('projModalTag').textContent   = p.tag;
  document.getElementById('projModalTitle').textContent = p.title;
  document.getElementById('projModalYear').textContent  = p.year;
  document.getElementById('projModalContent').innerHTML = p.content;
  document.getElementById('projPrev').disabled = (currentVisibleIdx === 0);
  document.getElementById('projNext').disabled = (currentVisibleIdx === visibleProjects.length - 1);
  document.getElementById('projModal').scrollTop = 0;
}

function navProj(dir) {
  const n = currentVisibleIdx + dir;
  if (n < 0 || n >= visibleProjects.length) return;
  currentVisibleIdx = n;
  renderProj();
}

function closeProjModal() {
  document.getElementById('projOverlay').classList.remove('active');
  document.body.style.overflow = '';
}
function overlayClick(e) {
  if (e.target === document.getElementById('projOverlay')) closeProjModal();
}

document.addEventListener('keydown', e => {
  if (!document.getElementById('projOverlay').classList.contains('active')) return;
  if (e.key === 'Escape')     closeProjModal();
  if (e.key === 'ArrowLeft')  navProj(-1);
  if (e.key === 'ArrowRight') navProj(+1);
});

/* ── SWIPE TO NAVIGATE PROJECTS (mobile) ── */
let touchStartX = 0;
let touchStartY = 0;
let swipeHandled = false;
let swipeLocked  = false;   /* true once we've determined swipe direction */

const projModal = document.getElementById('projModal');

projModal.addEventListener('touchstart', e => {
  touchStartX  = e.touches[0].clientX;
  touchStartY  = e.touches[0].clientY;
  swipeHandled = false;
  swipeLocked  = false;
}, { passive: true });

projModal.addEventListener('touchmove', e => {
  if (swipeLocked) return;
  const dx = e.touches[0].clientX - touchStartX;
  const dy = e.touches[0].clientY - touchStartY;

  /* Once we have enough movement to judge direction, lock in */
  if (Math.abs(dx) > 8 || Math.abs(dy) > 8) {
    swipeLocked = true;
    if (Math.abs(dx) > Math.abs(dy) * 1.2) {
      /* Horizontal swipe — prevent browser back/forward navigation */
      e.preventDefault();
    }
  }
}, { passive: false });   /* passive:false required to call preventDefault */

projModal.addEventListener('touchend', e => {
  if (swipeHandled) return;
  const dx = e.changedTouches[0].clientX - touchStartX;
  const dy = e.changedTouches[0].clientY - touchStartY;
  if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy) * 1.5) {
    swipeHandled = true;
    if (dx < 0) navProj(+1);  /* swipe left  → next */
    else        navProj(-1);  /* swipe right → prev */
  }
}, { passive: true });

/* ── CONTACT MODAL ── */
function openModal()  { document.getElementById('contactModal').classList.add('active');    document.body.style.overflow = 'hidden'; }
function closeModal() { document.getElementById('contactModal').classList.remove('active'); document.body.style.overflow = ''; }

async function handleSubmit(e) {
  e.preventDefault();
  try {
    const res = await fetch(e.target.action, { method: 'POST', body: new FormData(e.target), headers: { 'Accept': 'application/json' } });
    if (res.ok) { e.target.style.display = 'none'; document.getElementById('formSuccess').style.display = 'block'; }
  } catch { alert('Error sending message.'); }
}
</script>
</body>
</html>
